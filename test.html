<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>White Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007bff',
                        secondary: '#6c757d',
                        dark: '#343a40',
                        light: '#f8f9fa',
                        bilibili: '#00A1D6' // 添加Bilibili品牌蓝色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .device-card {
                @apply bg-white rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg;
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50;
            }
            .section-padding {
                @apply py-8 md:py-12;
            }
            .contact-card {
                @apply bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-md p-6 border border-blue-100;
            }
        }
    </style>
    <script>
        // 生成设备唯一标识 (浏览器指纹)
        function generateDeviceFingerprint() {
            // 收集浏览器和设备信息作为指纹
            const fingerPrintSources = [
                navigator.userAgent,
                navigator.language,
                navigator.platform,
                screen.width + 'x' + screen.height,
                screen.colorDepth,
                typeof localStorage,
                typeof sessionStorage,
                navigator.hardwareConcurrency,
                navigator.deviceMemory
            ];
            
            // 简单哈希函数生成唯一标识
            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // 转换为32位整数
                }
                return Math.abs(hash).toString(16);
            }
            
            return simpleHash(fingerPrintSources.join('|'));
        }

        // IP获取API列表
        const IP_API_LIST = [
            'https://api.ipify.org?format=json',
            'https://ipapi.co/json/',
            'https://ipinfo.io/json'
        ];
        
        async function getClientIP(retries = 2, delay = 1000) {
            for (const api of IP_API_LIST) {
                try {
                    const response = await fetch(api);
                    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                    
                    const data = await response.json();
                    const ip = data.ip || data.ip_address;
                    if (ip) return ip;
                } catch (error) {
                    console.log(`API ${api} 调用失败:`, error.message);
                    if (retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        retries--;
                    }
                }
            }
            throw new Error('所有IP获取接口失败');
        }
        
        // 检查是否为重复访问（防刷检测）
        function checkDuplicateVisit(deviceId, ip) {
            const visitsKey = 'validVisits';
            let visits = JSON.parse(localStorage.getItem(visitsKey) || '[]');
            
            // 检查过去24小时内是否有相同设备或IP的访问
            const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;
            const recentVisits = visits.filter(visit => visit.timestamp > oneDayAgo);
            
            // 检查设备ID或IP是否已存在
            const isDuplicate = recentVisits.some(visit => 
                visit.deviceId === deviceId || (ip && visit.ip === ip)
            );
            
            // 记录新访问（如果不是重复的）
            if (!isDuplicate) {
                visits.push({
                    deviceId,
                    ip,
                    timestamp: Date.now()
                });
                localStorage.setItem(visitsKey, JSON.stringify(visits));
            }
            
            return isDuplicate;
        }
        
        // 获取唯一访客数量
        function getUniqueVisitorsCount() {
            const visitsKey = 'validVisits';
            const visits = JSON.parse(localStorage.getItem(visitsKey) || '[]');
            const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;
            
            // 过滤出24小时内的有效访问
            const recentVisits = visits.filter(visit => visit.timestamp > oneDayAgo);
            
            // 使用Set收集唯一设备ID
            const uniqueDevices = new Set();
            recentVisits.forEach(visit => uniqueDevices.add(visit.deviceId));
            
            return uniqueDevices.size;
        }
        
        // 获取当前设备的访问次数
        function getDeviceVisitCount(deviceId) {
            const visitsKey = 'validVisits';
            const visits = JSON.parse(localStorage.getItem(visitsKey) || '[]');
            return visits.filter(visit => visit.deviceId === deviceId).length;
        }
        
        window.onload = async function() {
            // 生成设备唯一标识
            const deviceId = generateDeviceFingerprint();
            let clientIP = null;
            let isDuplicate = false;
            
            try {
                // 获取IP地址
                clientIP = await getClientIP();
                
                // 检查是否为重复访问
                isDuplicate = checkDuplicateVisit(deviceId, clientIP);
                
                // 更新显示信息
                const uniqueVisitors = getUniqueVisitorsCount();
                const deviceVisits = getDeviceVisitCount(deviceId);
                
                document.getElementById('viewCount').textContent = `今日浏览人数: ${uniqueVisitors}`;
                document.getElementById('ipInfo').textContent = `您的IP: ${clientIP}`;
                document.getElementById('deviceId').textContent = `设备标识: ${deviceId.substring(0, 12)}...`;
                document.getElementById('visitCount').textContent = `本设备今日访问: ${deviceVisits} 次`;
                
                // 显示防刷检测结果
                const antiSpamResult = document.getElementById('antiSpamResult');
                if (isDuplicate) {
                    antiSpamResult.innerHTML = '<i class="fa fa-exclamation-triangle text-yellow-500"></i> 检测到重复访问，本次不计入统计';
                    antiSpamResult.className = 'text-yellow-500 font-medium mt-2';
                } else {
                    antiSpamResult.innerHTML = '<i class="fa fa-check-circle text-green-500"></i> 验证通过，正常访问';
                    antiSpamResult.className = 'text-green-500 font-medium mt-2';
                }
                
            } catch (error) {
                console.error('获取IP失败:', error);
                
                // IP获取失败时，仅使用设备ID进行防刷检测
                isDuplicate = checkDuplicateVisit(deviceId, null);
                
                const uniqueVisitors = getUniqueVisitorsCount();
                const deviceVisits = getDeviceVisitCount(deviceId);
                
                document.getElementById('viewCount').textContent = `今日浏览人数: ${uniqueVisitors}`;
                document.getElementById('ipInfo').textContent = "IP检测服务暂时不可用";
                document.getElementById('deviceId').textContent = `设备标识: ${deviceId.substring(0, 12)}...`;
                document.getElementById('visitCount').textContent = `本设备今日访问: ${deviceVisits} 次`;
                
                // 显示防刷检测结果
                const antiSpamResult = document.getElementById('antiSpamResult');
                if (isDuplicate) {
                    antiSpamResult.innerHTML = '<i class="fa fa-exclamation-triangle text-yellow-500"></i> 检测到重复访问，本次不计入统计';
                    antiSpamResult.className = 'text-yellow-500 font-medium mt-2';
                } else {
                    antiSpamResult.innerHTML = '<i class="fa fa-check-circle text-green-500"></i> 验证通过，正常访问';
                    antiSpamResult.className = 'text-green-500 font-medium mt-2';
                }
            }
        };
    </script>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 max-w-3xl">
        <!-- 头部区域 -->
        <header class="text-center section-padding">
            <img src="title.png" alt="White Client" width="1538" height="472" class="mx-auto"/>
            <p class="text-secondary text-lg mb-2">开放*创新</p>
            <p class="text-secondary">Client</p>
        </header>
        
        <!-- 设备信息与防刷区域 -->
        <section class="section-padding">
            <div class="device-card">
                <h2 class="text-xl font-semibold text-dark mb-4 flex items-center">
                    <i class="fa fa-shield text-primary mr-2"></i>设备验证与统计
                </h2>
                
                <div class="space-y-3 text-gray-700">
                    <p id="viewCount" class="p-2 bg-gray-50 rounded-lg"></p>
                    <p id="ipInfo" class="p-2 bg-gray-50 rounded-lg"></p>
                    <p id="deviceId" class="p-2 bg-gray-50 rounded-lg text-sm"></p>
                    <p id="visitCount" class="p-2 bg-gray-50 rounded-lg"></p>
                    <div id="antiSpamResult"></div>
                </div>
                
                <div class="mt-4 text-sm text-gray-500">
                    <p><i class="fa fa-info-circle mr-1"></i> 验证</p>
                    <p><i class="fa fa-clock-o mr-1"></i> 每日统计数据按24小时周期更新</p>
                </div>
            </div>
        </section>
        
        <!-- 下载区域 -->
        <section class="section-padding text-center">
            <a href="https://github.com/jjjmmmdexh227/jjjmmmdexh/raw/main/Client3.4.apk" 
               class="btn-primary inline-flex items-center">
                <i class="fa fa-download mr-2"></i> 下载White Client <span class="text-sm text-gray-400">(版本: 3.4)</span>
            </a>
            
            <div class="mt-6 text-gray-600 text-sm">
                <p>jjjmmmdexh制作</p>
            </div>
        </section>
        
        <!-- about -->
        <section class="section-padding">
            <div class="contact-card">
                <h2 class="text-xl font-semibold text-dark mb-4 flex items-center">
                    <i class="fa fa-envelope text-primary mr-2"></i>关于
                </h2>
                
                <div class="space-y-4 text-gray-700">
                    <div class="flex items-center p-3 bg-white rounded-lg shadow-sm">
                        <div class="bg-blue-100 p-2 rounded-full mr-3">
                            <i class="fa fa-qq text-blue-600"></i>
                        </div>
                        <div>
                            <p class="font-medium">QQ</p>
                            <p class="text-sm text-gray-500">1591123827</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-3 bg-white rounded-lg shadow-sm">
                        <div class="bg-blue-100 p-2 rounded-full mr-3">
                            <i class="fa fa-envelope text-blue-600"></i>
                        </div>
                        <div>
                            <p class="font-medium">E-MAIL</p>
                            <a href="mailto:name1591123827@163.com" class="text-sm text-primary hover:underline">name1591123827@163.com</a>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-3 bg-white rounded-lg shadow-sm">
                        <div class="bg-blue-100 p-2 rounded-full mr-3 flex items-center justify-center">
                            <!-- Bilibili -->
                            <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.51.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .356-.124.657-.373.906l-1.174 1.12zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.789 1.894v7.52c.02.765.283 1.395.789 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.128.789-1.893v-7.52c-.02-.765-.283-1.396-.789-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373z" fill="#00A1D6"/>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium">bilibili</p>
                            <a href="https://space.bilibili.com/3546584027499085" target="_blank" class="text-sm text-primary hover:underline">jjjmmmdexh</a>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 text-sm text-gray-500">
                </div>
            </div>
        </section>
        
        <!-- 底部区域 -->
        <footer class="py-6 text-center text-gray-500 text-sm">
            <p>All things by jjjmmmdexh</p>
        </footer>
    </div>
</body>
</html>
